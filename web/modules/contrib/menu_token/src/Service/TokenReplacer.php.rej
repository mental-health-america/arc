***************
*** 81,87 ****
     *   Returns replaced token.
     */
    public function replaceContext($token, $key, BubbleableMetadata $b) {
- 
      $token_type = $this->getTokenType($token);
      $entity_type = $this->tokenEntityMapper->getEntityTypeForTokenType($token_type);
  
--- 81,86 ----
     *   Returns replaced token.
     */
    public function replaceContext($token, $key, BubbleableMetadata $b) {
      $token_type = $this->getTokenType($token);
      $entity_type = $this->tokenEntityMapper->getEntityTypeForTokenType($token_type);
  
***************
*** 97,102 ****
      $real_context = $this->contextRepository->getRuntimeContexts(array_keys($contexts_def));
  
      foreach ($real_context as $key_i => $real_ci) {
        $context_data_definition_type = $real_ci->getContextData()->getPluginDefinition();
        $value = $real_ci->getContextData()->getValue();
  
--- 96,104 ----
      $real_context = $this->contextRepository->getRuntimeContexts(array_keys($contexts_def));
  
      foreach ($real_context as $key_i => $real_ci) {
+       if (!$real_ci->hasContextValue()) {
+         continue;
+       }
        $context_data_definition_type = $real_ci->getContextData()->getPluginDefinition();
        $value = $real_ci->getContextData()->getValue();
  
