***************
*** 386,394 ****
    $config_menu = \Drupal::entityTypeManager()->getStorage('link_configuration_storage')->load($uuId_from_link);
  
    // Replace nothing to mess here all action is in hook.
-   if (!empty($config_menu)) {
      $configuration = unserialize($config_menu->configurationSerialized);
-     $links[$relevant_link['id']][$replace_with] = $token_service->replace($links[$relevant_link['id']][$replace_with], [], ["configuration" => $configuration], $bubbleableMetadata);
      $links[$relevant_link['id']]["options"]["bubleble_metadata"] = $bubbleableMetadata;
    }
  }
--- 386,402 ----
    $config_menu = \Drupal::entityTypeManager()->getStorage('link_configuration_storage')->load($uuId_from_link);
  
    // Replace nothing to mess here all action is in hook.
+   if (!empty($config_menu)) 
+   {
      $configuration = unserialize($config_menu->configurationSerialized);
+     if (isset($links[$relevant_link['id']][$replace_with])) 
+     {
+         $links[$relevant_link['id']][$replace_with] = $token_service->replace($config_menu->linkid, [], ["configuration" => $configuration], $bubbleableMetadata);
+     }
+     else if ($replace_with == 'query' && isset($links[$relevant_link['id']]['options'][$replace_with])) 
+     {
+       $links[$relevant_link['id']]['options']['query'] = $token_service->replaceArray($links[$relevant_link['id']]['options']['query'], [], ["configuration" => $configuration], $bubbleableMetadata);
+     }
      $links[$relevant_link['id']]["options"]["bubleble_metadata"] = $bubbleableMetadata;
    }
  }
